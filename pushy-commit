#!/bin/dash
if [ "$#" -ne 2 ]; then
	echo "Usage: ./pushy-commit -m message"
	exit 1
fi

cd ".pushy/.index"|| exit 1;
pattern='^[^-]*$'
[ ! "$1" = "-m" ] && echo "Error: Needs -m specifier" && exit 1

if echo "$2" | grep -Eq "$pattern";
then
	for file in ./*
	do
		if [ -f "../$file" ];
		then
			cmp --silent "../$file" "$file" && echo "nothing to commit"
			exit 1
		fi
		cp "$file" "../$file"
	done
fi
cd ../ || exit 1
count=$(< log.txt wc -l)
echo "Committed as commit $count"
echo "$count $2" >> log.txt
